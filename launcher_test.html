<!DOCTYPE html>
<html>
<head>
    <title>Projectile for Paper Ball Take 001</title>
    <script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
    <script type="text/javascript">


var screenwidth=1200;
var screenheight=600;


var game = new Phaser.Game(screenwidth, screenheight, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update, render: render });

function preload() {
    game.load.image('background','images/Background.png');
    game.load.image('arrowExtension', 'images/green.png');
    game.load.image('arrow', 'images/longarrow2.png');
    game.load.image('ball', 'images/paperBall.png'); 
    game.load.image('slingshot', 'images/CatapultSprite.png')   
    game.load.image('student', 'images/donald.png'); 


}


var text;
var student;
var counter = 0;
var slingshotX = 300;
var slingshotY = 300
var slingshotHeight = 340
var arrow;
var ball;
var ballHeld = false; //checks if the ball is held or not
var ballSpeed = 0; // speed of the ball
var arrowExtensionWidth = 8;
var ballinitx=slingshotX+100;
var ballinity=slingshotY+65;

function create() {

    bground = game.add.sprite(0,0,'background')
    bground.alpha = 0.75; //transparency of background
    game.physics.startSystem(Phaser.Physics.ARCADE);

    // set global gravity
    game.physics.arcade.gravity.y = 100;

    //game.stage.backgroundColor = '#0072bc';

    text = game.add.text(450, 16, '', { fill: '#ffffff' });


    //  This creates a simple sprite that is using our loaded image and
    //  displays it on-screen and assign it to a variable
       student = game.add.sprite(game.world.centerX + 150 , game.world.centerY - 100, 'student');
    game.physics.enable(student, Phaser.Physics.ARCADE);

    student.body.allowGravity = false;

    student.body.collideWorldBounds = true;
    student.body.immovable = true;

    arrowExtension = game.add.sprite(slingshotX+100, slingshotY+50, 'arrowExtension');

    game.physics.enable(arrowExtension, Phaser.Physics.ARCADE);

    arrowExtension.body.allowGravity = false;
    arrowExtension.width = arrowExtensionWidth;
    arrowExtension.rotation = 220;
    arrowExtension.alpha = 0; //arrowExtension hidden
    arrowExtension.anchor.setTo(0.5, 0.0);
    
    arrow = game.add.sprite(slingshotX + 100, slingshotY + 50, 'arrow');

    game.physics.enable(arrow, Phaser.Physics.ARCADE);

    arrow.anchor.setTo(0.1, 0.5);
    arrow.body.moves = false;
    arrow.body.allowGravity = false;
    arrow.alpha = 0; //arrow hidden
    
    ball = game.add.sprite(ballinitx, ballinity, 'ball');
    ball.scale.setTo(0.15,0.15);
    game.physics.enable(ball, Phaser.Physics.ARCADE);
    ball.anchor.setTo(0.5, 0.5);
    ball.body.collideWorldBounds = false; //bounces against walls
    ball.body.allowGravity = false;
    
    
    // Enable input.
    ball.inputEnabled = true; //allows ball to be influenced by mouse input
    ball.events.onInputDown.add(holdBall); //when mouse is clicked
    ball.events.onInputUp.add(launchBall); //when mouse is released

    slingshot = game.add.sprite(slingshotX,slingshotY,'slingshot');
    slingshot.height = slingshotHeight
}

function holdBall(ball, pointer) {

    ball.body.moves = false;
    ball.body.velocity.setTo(0, 0);
    ball.body.allowGravity = false;
    ballHeld = true;

}

function launchBall() {

    ballHeld = false;
    ball.body.bounce.setTo(0.9, 0.9);
    ball.body.moves = true;
    arrow.alpha = 0;
    arrowExtension.alpha = 0;
    Xvector = (arrow.x - ball.x) * 3;
    Yvector = (arrow.y - ball.y) * 3;
    ball.body.allowGravity = true;  
    ball.body.velocity.setTo(Xvector, Yvector);

}

function update() {

    arrow.rotation = game.physics.arcade.angleBetween(arrow, ball);
    if (game.physics.arcade.collide(student, ball)){
        counter++;
        text.text = "You hit the student " + counter + " times!";
    }

    
    if (ballHeld == true)
    {
        //  Track the ball sprite to the mouse  
        ball.x = game.input.activePointer.worldX;   
        ball.y = game.input.activePointer.worldY;
        
        arrow.alpha = 1;    
        arrowExtension.alpha = 1.5;
        arrowExtension.rotation = arrow.rotation- 3.14 / 2;
        arrowExtension.height = game.physics.arcade.distanceToPointer(arrow);  
        ballSpeed = arrowExtension.height;
    }   
    
    if (ball.x < 0 || ball.x> screenwidth || ball.y > screenheight || ball.y < 0){
     restart();   
    }

}
function restart(){
    ballSpeed=0;
        ball.reset(ballinitx,ballinity);
        ball.body.allowGravity = false;
}

function render() {

    game.debug.text("Drag the ball and release to launch", 32, 32);

}


</script>

</body>
</html>